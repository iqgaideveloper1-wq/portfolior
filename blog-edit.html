<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>Edit Post - Ranjithkumar Baluchamy</title>

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Raleway:300,300i,400,400i,500,500i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
  <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
  
  <!-- TinyMCE Rich Text Editor -->
  <script src="https://cdn.tiny.cloud/1/no-api-key/tinymce/6/tinymce.min.js" referrerpolicy="origin"></script>

  <style>
    body{font-family:"Open Sans",sans-serif;color:#272829}
    a{color:#149ddd;text-decoration:none}
    a:hover{color:#37b3ed;text-decoration:none}
    h1,h2,h3,h4,h5,h6{font-family:"Raleway",sans-serif}
    #main{margin-left:100px}
    @media (max-width:991px){#main{margin-left:0}}
    #preloader{position:fixed;top:0;left:0;right:0;bottom:0;z-index:9999;overflow:hidden;background:#fff}
    #preloader:before{content:"";position:fixed;top:calc(50% - 30px);left:calc(50% - 30px);border:6px solid #149ddd;border-top-color:#ecf8fe;border-radius:50%;width:60px;height:60px;animation:animate-preloader 1s linear infinite}
    @keyframes animate-preloader{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
    .admin-page{padding:80px 0}
    .breadcrumbs{padding:15px 0;background:#f5f8fd;min-height:40px;margin-top:60px}
    .breadcrumbs h2{font-size:24px;font-weight:300}
    .breadcrumbs ol{display:flex;flex-wrap:wrap;list-style:none;padding:0;margin:0;font-size:14px}
    .breadcrumbs ol li+li{padding-left:10px}
    .breadcrumbs ol li+li::before{display:inline-block;padding-right:10px;color:#6c757d;content:"/"}
    .mobile-nav-toggle{position:fixed;right:15px;top:15px;z-index:9998;border:0;font-size:24px;transition:all .4s;outline:none!important;background-color:#149ddd;color:#fff;width:40px;height:40px;display:none;align-items:center;justify-content:center;line-height:0;border-radius:50px;cursor:pointer}@media (max-width:991px){.mobile-nav-toggle{display:flex}.navbar{position:fixed;top:0;right:0;left:0;bottom:0;background:rgba(5,13,24,.9);transition:all .4s;z-index:9997;transform:translateX(100%);padding:30px;overflow-y:auto}.mobile-nav-active .navbar{transform:translateX(0)}.navbar ul{display:block;position:absolute;top:55px;right:15px;bottom:15px;left:15px;padding:10px 0;border-radius:10px;background-color:#fff;overflow-y:auto;transition:.3s;z-index:9995}.navbar .nav-link{display:flex;align-items:center;justify-content:flex-start;padding:10px 20px;margin:5px 15px;width:auto;height:auto;border-radius:4px;font-size:15px;color:#45505b;background:0 0;box-shadow:none}.navbar .nav-link i{font-size:16px;margin-right:10px;color:#45505b}.navbar .nav-link span{display:inline}.navbar .nav-link:hover,.navbar .nav-link.active{color:#149ddd}.navbar .nav-link:hover i,.navbar .nav-link.active i{color:#149ddd}}
    #footer{padding:25px 0;background:#f5f8fd;text-align:center;font-size:14px}
  </style>
</head>

<body>
  <div id="preloader"></div>
  <i class="bi bi-list mobile-nav-toggle"></i>
  <nav id="navbar" class="navbar">
    <ul>
      <li><a href="index.html#hero" class="nav-link" title="Home"><i class='bx bx-home'></i> <span>Home</span></a></li>
      <li><a href="index.html#about" class="nav-link" title="About"><i class='bx bx-user'></i> <span>About</span></a></li>
      <li><a href="index.html#skills" class="nav-link" title="Skills"><i class='bx bx-code-alt'></i> <span>Skills</span></a></li>
      <li><a href="index.html#resume" class="nav-link" title="Resume"><i class='bx bx-file-blank'></i> <span>Resume</span></a></li>
      <li><a href="index.html#services" class="nav-link" title="Services"><i class='bx bx-server'></i> <span>Services</span></a></li>
      <li><a href="index.html#portfolio" class="nav-link" title="Portfolio"><i class='bx bx-book-content'></i> <span>Portfolio</span></a></li>
      <li><a href="index.html#achievements" class="nav-link" title="Achievements"><i class='bx bx-award'></i> <span>Achievements</span></a></li>
      <li><a href="index.html#testimonials" class="nav-link" title="Testimonials"><i class='bx bx-comment-detail'></i> <span>Testimonials</span></a></li>
      <li><a href="index.html#contact" class="nav-link" title="Contact"><i class='bx bx-envelope'></i> <span>Contact</span></a></li>
      <li><a href="blog.html" class="nav-link" title="Blog"><i class='bx bx-news'></i> <span>Blog</span></a></li>
      <li><a href="blog-admin.html" class="nav-link active" title="Blog Admin"><i class='bx bx-edit'></i> <span>Blog Admin</span></a></li>
    </ul>
  </nav>

  <main id="main">
    <section class="breadcrumbs">
      <div class="container">
        <div class="d-flex justify-content-between align-items-center">
          <h2 id="page-title">Add Post</h2>
          <ol>
            <li><a href="index.html">Home</a></li>
            <li><a href="blog-admin.html">Blog Admin</a></li>
            <li id="breadcrumb-title">Add Post</li>
          </ol>
        </div>
      </div>
    </section>

    <section class="admin-page">
      <div class="container">
        <form id="post-form" class="card p-4">
          <input type="hidden" id="postId" name="postId">
          <div class="mb-3">
            <label for="title" class="form-label">Title</label>
            <input type="text" class="form-control" id="title" required>
          </div>
          <div class="mb-3">
            <label for="image" class="form-label">Image URL</label>
            <input type="url" class="form-control" id="image" required>
          </div>
          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="author" class="form-label">Author</label>
              <input type="text" class="form-control" id="author" required>
            </div>
            <div class="col-md-6 mb-3">
              <label for="date" class="form-label">Date</label>
              <input type="text" class="form-control" id="date" placeholder="e.g., May 20, 2024" required>
            </div>
          </div>
          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="category" class="form-label">Category</label>
              <input type="text" class="form-control" id="category" required>
            </div>
            <div class="col-md-6 mb-3">
              <label for="tags" class="form-label">Tags (comma separated)</label>
              <input type="text" class="form-control" id="tags" required>
            </div>
          </div>
          <div class="mb-3">
            <label for="content" class="form-label">Content</label>
            <textarea class="form-control" id="content" rows="10"></textarea>
          </div>
          <div class="text-end">
            <a href="blog-admin.html" class="btn btn-secondary">Cancel</a>
            <button type="submit" class="btn btn-primary" id="submit-button">Save Post</button>
          </div>
        </form>
      </div>
    </section>
  </main>

  <footer id="footer">
    <div class="container">
      <div class="copyright">
        &copy; Copyright <strong><span>MyResume</span></strong>
      </div>
      <div class="credits">
        Designed by <a href="https://bootstrapmade.com/">BootstrapMade</a>
      </div>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="blog-data.js"></script>
  <script>
    tinymce.init({
        selector: '#content',
        plugins: 'autolink lists link image charmap preview anchor',
        toolbar: 'undo redo | bold italic | alignleft aligncenter alignright | bullist numlist outdent indent | link',
        height: 350,
        menubar: false,
    });
    
    document.addEventListener('DOMContentLoaded', () => {
      "use strict";
      const select = (el) => document.querySelector(el);
      const on = (type, el, listener) => select(el)?.addEventListener(type, listener);
      
      let preloader = select('#preloader');
      if (preloader) {
        window.addEventListener('load', () => preloader.remove());
      }
      
      on('click', '.mobile-nav-toggle', function(e) {
        select('body').classList.toggle('mobile-nav-active');
        this.classList.toggle('bi-list');
        this.classList.toggle('bi-x');
      });

      // --- BLOG EDIT LOGIC ---
      const form = select('#post-form');
      const params = new URLSearchParams(window.location.search);
      const postId = params.get('id') ? parseInt(params.get('id')) : null;

      function getBlogData() {
        const posts = localStorage.getItem('blogPosts');
        return posts ? JSON.parse(posts) : blogData;
      }

      function saveBlogData(posts) {
        localStorage.setItem('blogPosts', JSON.stringify(posts));
      }

      function initializeForm() {
        if (!postId) return; // Add mode, do nothing

        // Edit mode
        const pageTitle = select('#page-title');
        const breadcrumbTitle = select('#breadcrumb-title');
        const submitButton = select('#submit-button');

        pageTitle.textContent = 'Edit Post';
        breadcrumbTitle.textContent = 'Edit Post';
        submitButton.textContent = 'Update Post';
        
        const posts = getBlogData();
        const post = posts.find(p => p.id === postId);

        if (post) {
          select('#postId').value = post.id;
          select('#title').value = post.title;
          select('#image').value = post.image;
          select('#author').value = post.author;
          select('#date').value = post.date;
          select('#category').value = post.category;
          select('#tags').value = post.tags.join(', ');
          select('#content').value = post.content;
        } else {
            alert('Post not found!');
            window.location.href = 'blog-admin.html';
        }
      }

      function handleSubmit(event) {
        event.preventDefault();
        
        const posts = getBlogData();
        const tagsArray = select('#tags').value.split(',').map(tag => tag.trim());

        const postData = {
          id: postId || Date.now(), // Create new ID if it's a new post
          title: select('#title').value,
          image: select('#image').value,
          author: select('#author').value,
          date: select('#date').value,
          category: select('#category').value,
          tags: tagsArray,
          content: tinymce.get('content').getContent(),
        };

        if (postId) {
          // Update existing post
          const index = posts.findIndex(p => p.id === postId);
          if(index !== -1) posts[index] = postData;
        } else {
          // Add new post
          posts.push(postData);
        }

        saveBlogData(posts);
        alert('Post saved successfully!');
        window.location.href = 'blog-admin.html';
      }

      if (form) {
        initializeForm();
        form.addEventListener('submit', handleSubmit);
      }
    });
  </script>
</body>
</html>